[env]
OPENSSL_NO_VENDOR = "1"
OPENSSL_PREBUILT_DIR = "C:\\Program Files\\OpenSSL-Win64"
OPENSSL_DIR = "${OPENSSL_PREBUILT_DIR}"

[tasks.ensure-openssl]
description = "Validate the prebuilt OpenSSL install path."
script_runner = "cmd"
script = [
  "if exist \"%OPENSSL_DIR%\" (echo OpenSSL found at %OPENSSL_DIR%) else (echo OpenSSL not found at %OPENSSL_DIR% & exit /b 1)",
]

[tasks.install-openssl-prebuilt]
description = "Install prebuilt OpenSSL silently via winget (Shining Light OpenSSL Light)."
script_runner = "powershell"
script = [
  "winget install -e --id ShiningLight.OpenSSL.Light --silent --accept-source-agreements --accept-package-agreements --disable-interactivity",
  "Write-Host \"OpenSSL installed to $env:OPENSSL_PREBUILT_DIR\"",
]

[tasks.lint]
description = "Run Rust formatting and clippy checks for Tauri."
script_runner = "powershell"
cwd = "src-tauri"
dependencies = ["ensure-openssl"]
script = ["cargo fmt -- --check", "cargo clippy -- -D warnings"]

[tasks.test]
description = "Run Rust coverage tests for Tauri."
script_runner = "powershell"
cwd = "src-tauri"
dependencies = ["ensure-openssl"]
script = ["cargo llvm-cov --features coverage --fail-under-lines 100"]

[tasks.tauri-build]
description = "Build the Tauri app."
script_runner = "powershell"
dependencies = ["ensure-openssl"]
script = ["cargo tauri build"]

[tasks.dev]
description = "Run the Tauri dev app."
script_runner = "powershell"
dependencies = ["ensure-openssl"]
script = ["cargo tauri dev"]

[tasks.ci]
description = "Run Tauri lint, build, and tests."
dependencies = ["lint", "tauri-build", "test"]
